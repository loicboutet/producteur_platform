<div class="max-w-2xl mx-auto">
  <div class="bg-white shadow rounded-lg p-8">
    <h1 class="text-3xl font-bold text-gray-900 mb-6">ðŸ›’ Place Order</h1>

    <div class="border rounded-lg p-4 mb-6">
      <div class="flex justify-between items-start mb-2">
        <div>
          <h3 class="text-lg font-semibold text-gray-900"><%= @product.name %></h3>
          <p class="text-sm text-gray-500">By <%= @product.producer.name %></p>
        </div>
        <span class="text-xl font-bold text-green-600"><%= @product.formatted_price %></span>
      </div>
      <p class="text-sm text-gray-600">Available: <%= @product.stock %> units</p>
    </div>

    <%= form_with model: @order, url: product_orders_path(@product), class: "space-y-6" do |f| %>
      <% if @order.errors.any? %>
        <div class="bg-red-50 border border-red-400 text-red-700 px-4 py-3 rounded">
          <ul class="list-disc list-inside">
            <% @order.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <div>
        <%= f.label :quantity, "Quantity", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.number_field :quantity, min: 1, max: @product.stock, value: 1, class: "w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500", id: "order_quantity" %>
      </div>

      <div class="bg-gray-50 rounded-lg p-4 space-y-2" id="order_summary">
        <div class="flex justify-between text-sm">
          <span class="text-gray-600">Subtotal:</span>
          <span class="font-medium" id="subtotal"><%= @product.formatted_price %></span>
        </div>
        <div class="flex justify-between text-sm">
          <span class="text-gray-600">Platform Fee (10%):</span>
          <span class="font-medium" id="platform_fee">â‚¬<%= format('%.2f', @product.price * 0.10) %></span>
        </div>
        <div class="flex justify-between text-sm">
          <span class="text-gray-600">Producer Receives:</span>
          <span class="font-medium text-green-600" id="producer_amount">â‚¬<%= format('%.2f', @product.price * 0.90) %></span>
        </div>
        <div class="border-t pt-2 flex justify-between font-bold text-lg">
          <span>Total:</span>
          <span class="text-green-600" id="total"><%= @product.formatted_price %></span>
        </div>
      </div>

      <div class="bg-blue-50 border-l-4 border-blue-400 p-4">
        <p class="text-sm text-blue-700">
          You'll be taken to a secure payment page after clicking "Continue to Payment"
        </p>
      </div>

      <div class="flex items-center justify-between">
        <%= f.submit "Continue to Payment", class: "px-6 py-3 bg-green-600 text-white font-medium rounded-md hover:bg-green-700 cursor-pointer" %>
        <%= link_to "Cancel", product_path(@product), class: "text-gray-600 hover:text-gray-900" %>
      </div>
    <% end %>
  </div>
</div>

<script>
  document.addEventListener('turbo:load', function() {
    const quantityInput = document.getElementById('order_quantity');
    const pricePerUnit = <%= @product.price %>;
    
    if (quantityInput) {
      quantityInput.addEventListener('input', function() {
        const quantity = parseInt(this.value) || 1;
        const subtotal = pricePerUnit * quantity;
        const platformFee = subtotal * 0.10;
        const producerAmount = subtotal * 0.90;
        
        document.getElementById('subtotal').textContent = 'â‚¬' + subtotal.toFixed(2);
        document.getElementById('platform_fee').textContent = 'â‚¬' + platformFee.toFixed(2);
        document.getElementById('producer_amount').textContent = 'â‚¬' + producerAmount.toFixed(2);
        document.getElementById('total').textContent = 'â‚¬' + subtotal.toFixed(2);
      });
    }
  });
</script>
